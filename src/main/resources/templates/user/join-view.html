<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" 
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layouts/default}">

<section layout:fragment="contents">
    <div class="container mt-5">
        <div class="card p-5 shadow-lg">
            <h3 class="text-center mb-4">회원가입</h3>

                <div class="form-group">
                    <label for="loginId">아이디</label>
                    <div class="d-flex">
                   		<input type="text" id="loginIdInput" placeholder="아이디를 입력해주세요" class="form-control col-9">
                  		<button type="button" class="btn btn-info btn-sm col-3" id="duplicateBtn">중복확인</button>
                	</div>
            		<div class="small text-success d-none" id="availableText">사용 가능한 ID 입니다.</div>
					<div class="small text-danger d-none" id="duplicateText">중복된 ID 입니다.</div>
                </div>

                <div class="form-group">
                    <label for="password">비밀번호</label>
                    <input type="password" id="passwordInput" placeholder="비밀번호를 입력해주세요" class="form-control">
                </div>

                <div class="form-group">
                    <label for="name">이름</label>
                    <input type="text" id="nameInput" placeholder="이름을 입력해주세요" class="form-control">
                </div>

                <div class="form-group">
                    <label for="nickname">닉네임</label>
                    <input type="text" id="nickNameInput" placeholder="닉네임을 입력해주세요" class="form-control">
                </div>

                <div class="form-group">
                    <label for="birthday">생년월일</label>
                    <input type="date" id="birthdayInput" placeholder="생년월일을 입력해주세요" class="form-control">
                </div>

                <div class="form-group">
                    <label for="email">이메일</label>
                    <input type="email" id="emailInput" placeholder="이메일을 입력해주세요" class="form-control">
                </div>


	            <!-- 성별 선택 라디오 인풋 -->
                <div class="form-group">
                    <label>성별</label>
                    <div class="d-flex">
                        <div class="form-check form-check-inline mr-3">
                            <input class="form-check-input" type="radio" id="male" name="gender" value="male" checked>
                            <label class="form-check-label" for="male">남성</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" id="female" name="gender" value="female">
                            <label class="form-check-label" for="female">여성</label>
                        </div>
                    </div>
                </div>

                <button type="button" class="btn btn-success btn-block mt-4" id="joinBtn">가입하기</button>
        </div>
    </div>
</section>

<script layout:fragment="script">
	$(document).ready(function() {

		var checkDuplicateId = false;
		var isDuplicateId = true;

		// 아이디 입력 시 중복확인 상태 초기화
		$("#loginIdInput").on("input", function() {

			checkDuplicateId = false;
			isDuplicateId = true;

			$("#availableText").addClass("d-none");
			$("#duplicateText").addClass("d-none");

		});

		// 중복확인 버튼 클릭 시
		$("#duplicateBtn").on("click", function() {

			let loginId = $("#loginIdInput").val();

			if (loginId == "") {
				alert("아이디를 입력하세요");
				return;
			}

			$.ajax({
				tpye:"get"
				, url: "/user/duplicateIdCheck"
				, data: {"loginId": loginId}
				, success: function (data) {

					checkDuplicateId = true;
					isDuplicateId = data.isDuplicateId;

					if (data.isDuplicateId) {
						$("#duplicateText").removeClass("d-none");
						$("#availableText").addClass("d-none");
					} else {
						$("#availableText").removeClass("d-none");
						$("#duplicateText").addClass("d-none");
					}
				}
				,error: function () {
					alert("중복확인 에러 !!");
				}
			});

		});

		// 가입하기 버튼 클릭 시
		$("#joinBtn").on("click", function () {

			let loginId = $("#loginIdInput").val();
			let password = $("#passwordInput").val();
			let name = $("#nameInput").val();
			let nickName = $("#nickNameInput").val();
			let birthday = $("#birthdayInput").val();
			let email = $("#emailInput").val();
			let gender = $("input[name='gender']:checked").val();

			// 유효성 검사
			if (loginId == "") {
				alert("아이디를 입력하세요");
				return;
			}

			if (password == "") {
				alert("비밀번호를 입력하세요");
				return;
			}

			if (name == "") {
				alert("이름을 입력하세요");
				return;
			}

			if (nickName == "") {
				alert("닉네임을 입력하세요");
				return;
			}

			if (birthday == "") {
				alert("생년월일을 입력하세요");
				return;
			}

			if (email == "") {
				alert("이메일을 입력하세요");
				return;
			}

			// 중복 확인 여부
			if (!checkDuplicateId) {
				alert("아이디 중복확인을 해주세요");
				return;
			}

			// 회원가입 처리
			$.ajax({
				type:"post"
				, url:"/user/join"
				, data: {
					"loginId": loginId
					, "password": password
					, "name": name
					, "nickName": nickName
					, "birthday": birthday
					, "email": email
					, "gender": gender
				}
				,success: function (data) {
					if (data.result == "success") {
						location.href = "/user/login-view";
					} else {
						alert("회원가입 실패 !!");
					}
				}
				,error: function () {
					alert("회원가입 에러!!");
				}
			});

		});

	});

</script>

</html>